---
title: JS代码段
tags:
  - 代码段
  - JavaScript
folder:
  - 待分类
abbrlink: 9f2501ad
category:
  - 速查表
date: 2018-07-03 10:34:41
---

******

<!-- more -->

# JS代码段记录

| 名称                                              | 简介                     | 备注                                             |
| ------------------------------------------------- | ------------------------ | ------------------------------------------------ |
| <a href='#formateTime'>简易时间格式化</a>         | 时间格式化工具           | 在 Date 对象上扩展了 Format 方法对时间进行格式化 |
| <a href='#forbidRight'>禁止鼠标右键默认行为</a>   | 禁止鼠标右键默认行为     |                                                  |
| <a href='#mouseDirection'>判断鼠标移动方向</a>    | 判断鼠标移动方向         |                                                  |
| <a href='#getDOMEv'>获取元素上绑定的事件</a>      | 判断鼠标移动方向         | `$._data($('#mm-blocker')[0],'events');`         |
| <a href='#simpleModuleLoad'>简易模块加载</a>      | 简易模块加载             |                                                  |
| <a href='#videoPlay'>谷歌阻止视频自动播放问题</a> | 谷歌阻止视频自动播放问题 | 无声音的视频不受影响                             |
| <a href='#getDetect'>设备判断</a>                 | 获取客户端信息           |                                                  |
| <a href='#shake'>shake</a>                        | 震动函数                 |                                                  |
| <a href='#noJumpLoad'>无跳转加载</a> | 无跳转加载                 |                                                  |
| <a href='#jqAnimate'>利用 JQ-animate 实现运动</a> | 利用 JQ-animate 实现运动                 |                         |

## 详情

1.  <span id='formateTime'>简易时间格式化</span>

    ```js
        Date.prototype.Format = function (fmt) {
            var o = {
                "y+": this.getFullYear(),
                "M+": this.getMonth() + 1, //月份
                "d+": this.getDate(), //日
                "h+": this.getHours(), //小时
                "m+": this.getMinutes(), //分
                "s+": this.getSeconds(), //秒
                "q+": Math.floor((this.getMonth() + 3) / 3), //季度
                "S+": this.getMilliseconds() //毫秒
            };
            for (var k in o) {
                if (new RegExp("(" + k + ")").test(fmt)) {
                    if (k == "y+") {
                        fmt = fmt.replace(RegExp.$1, ("" + o[k]).substr(4 - RegExp.$1.length));
                    } else if (k == "S+") {
                        var lens = RegExp.$1.length;
                        lens = lens == 1 ? 3 : lens;
                        fmt = fmt.replace(RegExp.$1, ("00" + o[k]).substr(("" + o[k]).length - 1, lens));
                    } else {
                        fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
                    }
                }
            }
            return fmt;
        };
    ```

2.  <span id='forbidRight'>禁止鼠标右键默认行为</span>

    ```js

        $(function () {

            // if (window.Event) document.captureEvents(Event.MOUSEUP);
            $(document).on({
                'contextmenu': function () {
                    return false;
                },
                'mousedown': function (ev) {
                    if (window.Event) {
                        if (ev.which == 2 || ev.which == 3) {

                            return false;
                        }
                    } else if (ev.button == 2 || ev.button == 3) {
                        return false;
                    }
                }
            });
        })
    ```

3.  <span id='mouseDirection'>判断鼠标移动方向</span>

    ```js
        function getMouseDirection (element,event){
            var w = $(element).width();
            var h = $(element).height();
            
            var x = (event.pageX - element.offsetLeft - (w/2)) * ( w > h ? (h/w) : 1 );
            var y = (event.pageY - element.offsetTop  - (h/2)) * ( h > w ? (w/h) : 1 );
            
            var dirDetail = Math.round((((Math.atan2(y, x) * (180 / Math.PI)) + 180 ) / 90 ) + 3 )  % 4,
                dir;

            switch(dirDetail) {
                case 0:
                    dir = 'top';
                /** animations from the TOP **/
                break;
                case 1:
                    dir = 'right'
                /** animations from the RIGHT **/
                break;
                case 2:
                    dir = 'bottom'
                /** animations from the BOTTOM **/
                break;
                case 3:
                    dir = 'left'
                /** animations from the LEFT **/
                break;
            };
    
            return dirDetail;
        }

    ```

4.  <span id='simpleModuleLoad'>简易模块加载</span>

    ```js
        var MyModule = (function Manager (){

            var modules = {};

            function define (name, deps, impl){
                
                for (var i = 0; i < deps.length; i++) {
                    
                    console.log(modules[deps[i]]);
                    deps[i] = modules[deps[i]];
                }
                modules[name] = impl.apply( impl, deps);
            }

            function get (name){
                return modules[name];
            }

            return {
                define: define,
                get: get
            };
        })();

        MyModule.define('bar', [], function (){
            function hello (who){

                return 'Let me introduce:' + who;
            }

            return {
                hello: hello
            };
        });

        MyModule.define ('foo', ['bar'], function (bar){

            var hungry ='hippo';

            function awesome (){

                console.log(bar.hello(hungry).toUpperCase());
            }

            return {
                awesome: awesome
            };
        });

        var bar = MyModule.get('bar');
        var foo = MyModule.get('foo');

        console.log(bar.hello('hippo'));
        foo.awesome();
    ```
    
5.  <span id='videoPlay'>谷歌阻止视频自动播放问题</span>

    ```js
    if (Promise) {
        function videoplay(doms) {
            setInterval(function (){

            });
        }
        function testAutoPlay() {
            // 返回一个promise以告诉调用者检测结果
            return new Promise(resolve => {
                let audio = $('video')[0];
                let autoplay = true;
                // play返回的是一个promise
                audio.play().then(() => {
                    // 支持自动播放
                    autoplay = true;
                }).catch(err => {
                    // 不支持自动播放
                    autoplay = false;
                }).finally(() => {
                    // 告诉调用者结果
                    resolve(autoplay);
                });
            });
        }

        testAutoPlay().then(res => {
            if (!res) {
                $('#mslider video').each(function (i, e) {
                    let timer;
                    timer = setInterval(function (){
                        if(e.paused) {
                            $(e).attr('muted', true);
                            e.play();
                        } else {
                            clearInterval(timer);
                        }
                    }, 400)
                })
            }
        });
    }
    ```

6.  <span id="getDetect">设备判断</span>

    ```js
        let detect = (() => {
            function detect(ua, platform) {
                // console.log(ua, platform)
                var os = this.os = {},
                    browser = this.browser = {},
                    webkit = ua.match(/Web[kK]it[\/]{0,1}([\d.]+)/),
                    android = ua.match(/(Android);?[\s\/]+([\d.]+)?/),
                    osx = !!ua.match(/\(Macintosh\; Intel /),
                    ipad = ua.match(/(iPad).*OS\s([\d_]+)/),
                    ipod = ua.match(/(iPod)(.*OS\s([\d_]+))?/),
                    iphone = !ipad && ua.match(/(iPhone\sOS)\s([\d_]+)/),
                    webos = ua.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),
                    win = /Win\d{2}|Windows/.test(platform),
                    wp = ua.match(/Windows Phone ([\d.]+)/),
                    touchpad = webos && ua.match(/TouchPad/),
                    kindle = ua.match(/Kindle\/([\d.]+)/),
                    silk = ua.match(/Silk\/([\d._]+)/),
                    blackberry = ua.match(/(BlackBerry).*Version\/([\d.]+)/),
                    bb10 = ua.match(/(BB10).*Version\/([\d.]+)/),
                    rimtabletos = ua.match(/(RIM\sTablet\sOS)\s([\d.]+)/),
                    playbook = ua.match(/PlayBook/),
                    chrome = ua.match(/Chrome\/([\d.]+)/) || ua.match(/CriOS\/([\d.]+)/),
                    firefox = ua.match(/Firefox\/([\d.]+)/),
                    firefoxos = ua.match(/\((?:Mobile|Tablet); rv:([\d.]+)\).*Firefox\/[\d.]+/),
                    ie = ua.match(/MSIE\s([\d.]+)/) || ua.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),
                    webview = !chrome && ua.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),
                    safari = webview || ua.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/)

                // Todo: clean this up with a better OS/browser seperation:
                // - discern (more) between multiple browsers on android
                // - decide if kindle fire in silk mode is android or not
                // - Firefox on Android doesn't specify the Android version
                // - possibly devide in os, device and browser hashes

                if (browser.webkit = !!webkit) browser.version = webkit[1]

                if (android) os.android = true, os.version = android[2]
                if (iphone && !ipod) os.ios = os.iphone = true, os.version = iphone[2].replace(/_/g, '.')
                if (ipad) os.ios = os.ipad = true, os.version = ipad[2].replace(/_/g, '.')
                if (ipod) os.ios = os.ipod = true, os.version = ipod[3] ? ipod[3].replace(/_/g, '.') : null
                if (wp) os.wp = true, os.version = wp[1]
                if (webos) os.webos = true, os.version = webos[2]
                if (touchpad) os.touchpad = true
                if (blackberry) os.blackberry = true, os.version = blackberry[2]
                if (bb10) os.bb10 = true, os.version = bb10[2]
                if (rimtabletos) os.rimtabletos = true, os.version = rimtabletos[2]
                if (playbook) browser.playbook = true
                if (kindle) os.kindle = true, os.version = kindle[1]
                if (silk) browser.silk = true, browser.version = silk[1]
                if (!silk && os.android && ua.match(/Kindle Fire/)) browser.silk = true
                if (chrome) browser.chrome = true, browser.version = chrome[1]
                if (firefox) browser.firefox = true, browser.version = firefox[1]
                if (firefoxos) os.firefoxos = true, os.version = firefoxos[1]
                if (ie) browser.ie = true, browser.version = ie[1]
                if (safari && (osx || os.ios || win)) {
                    browser.safari = true
                    if (!os.ios) browser.version = safari[1]
                }
                if (webview) browser.webview = true

                //  判断是平板
                os.tablet = !!(ipad || playbook || (android && !ua.match(/Mobile/)) ||
                    (firefox && ua.match(/Tablet/)) || (ie && !ua.match(/Phone/) && ua.match(/Touch/)))

                //  判断是否是手机
                os.phone = !!(!os.tablet && !os.ipod && (android || iphone || webos || blackberry || bb10 ||
                    (chrome && ua.match(/Android/)) || (chrome && ua.match(/CriOS\/([\d.]+)/)) ||
                    (firefox && ua.match(/Mobile/)) || (ie && ua.match(/Touch/))))
                
                os.pc = !os.tablet && !os.phone;
            }
            let result = {};
            detect.call(result, navigator.userAgent, navigator.platform)
            return result;
        })();
        // make available to unit tests
        
    ```

7.  <span id="shake">shake</span>

    ```js
        let shake = (dom, limit, speed) => {
            var timer,
                dom = this;

            limit = limit ? limit : 10;

            $(dom).css({
                'position': 'relative'
            })

            timer = setInterval(function () {
                limit = limit * -16 / 20;
                if (Math.abs(limit) > 1) {

                    $(dom).css({

                        'left': limit
                    });
                } else {

                    $(dom).css({

                        'left': 0
                    });
                    clearInterval(timer);
                }
            }, 50);
        }
    ```

8.  <span id="noJumpLoad">无跳转加载</span>

    参考文档：`https://developer.mozilla.org/zh-CN/docs/Web/API/History_API`
        
    ```js
        function noJumpLoad (url) {
            
            if (history.pushState) { 
                history.replaceState({
                    u: url,
                    t: '标题'
                }, '', url);
                if (history.state.u) {
                    $.get(history.state.u, function (v) {
                        // doSomething
                    });
                }
                return false;
            }
        }
    ```

9.  <span id="jqAnimate">利用 JQ-animate 实现运动</span>

    ```js
        $({a: 100}).stop()
            .animate({
                a: 100
                },{
                step (t,i) {
                    $('#ceshi').html(t + ' ' + i);
                },
                duration: 3000,
                complete () {
                    $('#ceshi').html('完成');
                }
            })
    ```