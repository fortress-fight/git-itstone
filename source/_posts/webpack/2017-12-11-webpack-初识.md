---
title: webpack 初识
tags:
  - webpack
  - 自动化
  - 前端
categories:
  - 自动化
  - webpack
folder: webpack
abbrlink: 6cf9b105
date: 2017-12-11 23:27:10
photo: /xmind/webpack/webpack.png
---

webpack 初始，在我第一次接触到 webpack 的时候，webpack 的文档简直是要人命了，而隔壁家的 Gulp 文档则是极其简陋（但是已经可以解决很多问题了，学习 Gulp 可以在了解 [Gulp 中文网](https://www.gulpjs.com.cn/) 后，看一看 [Gulp 官网](https://gulpjs.com/)）。现在随着国内的有志之士的帮助，[webpack 中文](https://doc.webpack-china.org/) 也提供了很好的学习途径。感谢他们；

<!-- more -->

{% img /xmind/webpack/webpack.png %}

# Webpack

基于 webpack 3.* 的学习

{% blockquote %}
webpack: 一个高度配置的现代 JavaScript 应用程序模块（module）**打包器**
模块: 开发者将程序分解成离散功能块，这些功能块又称为模块
{% endblockquote %}

## 基础部署

{% blockquote %}
依赖软件：

- node
- npm （安装 node 后会自带 npm）
- cnpm  `$ npm install -g cnpm --registry=https://registry.npm.taobao.org`

{% endblockquote %}

******

### 安装 Webpack

全局安装 webpack `cnpm install -g webpack` 

{% blockquote %}
官方建议：本地进行 webpack 安装, 如果使用全局安装，将会锁定 webpack 版本
{% endblockquote %}

1. 新建一个学习文件夹：learn-webpack，初始化项目
    
    ```shell shell
        mkdir learn01
        cd learn01
        npm init
        # npm init 的时候会让输入一些基本信息，这是因为使用 `npm init` 是创建 npm 包的命令，
        # 需要输入的也是 npm 包所需信息，这里由于只是利用 npm 创建出的 `package.json` 文件
        # 对项目进行管理，所以这里的信息可以使用默认
    ```
2. 安装本地 webpack

    ```shell shell
        cnpm i --save-dev webpack
        # 或者使用 cnpm i -D webpack
        # -dev 是将 webpack 安装到开发环境中，意味着仅在开发环境下使用
        # 如果在 MAC 遇到权限问题 使用 `sudo cnpm i -D webpack`
    ```
3. 检测 webpack 版本

    ```shell shell
        webpack -v
        # 3.8.1
    ```

******

### webpack 基本使用

#### webpack 命令行运行

1. 进入 learn01 文件夹

    ```shell tree
        .
        └── learn01
            └── package.json

    ```
2. 建立基本的文件目录
    不必以这个为标准，建立适合自己使用的更加重要

    ```shell tree
        .
        └── learn01
            ├── dist
            │   └── index.html
            ├── package.json
            └── src
                └── entery.js

        # entery.js 是入口文件，上文中说过 webpack 是一个模块打包的工具，通过一个 entery.js 将各种资源文件引入，
        # 然后 webpack 接收这个入口文件，并输出打包结果；
        
    ```

    测试

    ```html dist/index.html
        <h1 id="title"></h1>
        <script src="./bundle.js"></script>
    ```

    ```js src/entery.js
        document.getElementById('#title').innerHTML = "webpack";
    ```

3. 使用 webpack 输出文件

    输入

    ```shell shell
        # webpack <infile-path> <outfile-path>
        webapck src/entery.js dist/bundle.js 
    ```
    输出

    ```shell shell
        Hash: 0bd4f09244f0e8c60354
        Version: webpack 3.10.0
        Time: 64ms
            Asset     Size  Chunks             Chunk Names
        bundle.js  2.47 kB       0  [emitted]  main
        [0] ./src/entery.js 0 bytes {0} [built]
    ```
    输出后目录

    ```shell tree
        .
        ├── dist
        └── learn01
            ├── dist
            │   ├── bundle.js
            │   └── index.html
            ├── package.json
            └── src
                └── entery.js
    ```

4. 结束

    我们可以查看打包后的文件 `bundler.js` 我们可以看到 webpack 中模块处理的代码；而我们写的代码段存在于底部

    ```js js dis/bunlde.js
        /* 0 */
        /***/ (function(module, exports) {

        document.getElementById('title').innerHTML = 'webpack';

        /***/ })
        /******/ ]);
    ```

#### webpack 配置运行

使用命令行运行未免太过于复杂，在 webpack 中可以通过使用配置 `webpack.config.js`, 来使用 webpack

1. 建立 webpack.config.js

    ```js
        .
        ├── dist
        │   ├── bundle.js
        │   └── index.html
        ├── package.json
        ├── src
        │   └── entery.js
        └── webpack.config.js

    ```

2. webpack.config.js 的基本结构

    ```js js webpack.config.js
        module.exports = {
            entry: {
                // 入口配置项
            },
            output: {
                // 出口配置项

            },
            module: {
                // 模块控制项（模块也就是各种引入的资源）

            },
            // 插件控制项，可能会存在多个插件
            plugins: [],
            devServer: {
                // 服务器控制项
                
            }
        }
    ```
    module.exports 是 ES6 提出的模块管理方法

3. webpack.config.js 的基本配置

    ```js js webpack.config.js
        const path = require('path');

        modules.exports = {
            entry: {
                // 入口配置项
                entry: './src/entery'
            },
            output: {
                // 出口配置项
                // path -- 出口路径
                // filename -- 出口文件名
                path: path.resolve(__dirname, 'dist'),
                filename: 'bundle.js'
            },
            module: {
                // 模块控制项（模块也就是各种引入的资源）

            },
            // 插件控制项，可能会存在多个插件
            plugins: [],
            devServer: {
                // 服务器控制项

            }
        }
    ```
    这里简单的解释一下，webpack 中 output 使用了绝对路径进行了输入，如果需要引入当前路径的绝对路径呢？这里使用了 Node 中的 path 模块，并且通过 `path.resolve(__dirname, 'dist')` 来获取 dist 的绝对路径。__dirname 是 Node 中的变量，表示当前文件所在路径；

4. 运行 webpack

    这时我们运行webpack（为了看到使用效果，对 `dist/bundle.js` 删除）

    ```shell shell
        webpack
    ```

    由于没有跟任何参数，所以 webpack 会查找当前路径下有没有 `webpack.config.js` 文件，如果存在就依照他的配置进行运作；

5. 结束

    ```shell tress
        .
        ├── dist
        └── learn01
            ├── dist
            │   ├── bundle.js
            │   └── index.html
            ├── package.json
            ├── src
            │   └── entery.js
            └── webpack.config.js
    ```
    我们可以看到和使用命令行的行为一直；
    这里可能会遇到一些，以前不了解的知识点，但是建议先按照步骤实现。如果能够对其理解，就先不要深究，不然会变得十分模糊的

#### webpack 的多文件引入

使用 webpack 可以具有多个入口文件，每一个入口文件都会进过 webpack 处理后输出

1. 建立 entry2.js

    ```js js src/entry2.js
        alert('这里是多文件引入');
    ```

2. 修改 index.html

    ```html index.html dist/index.html
        <script src="./entry.js"></script>
        <script src="./entry2.js"></script>
    ```

3. 修改 webpack.config.js

    ```js webpack.config.js ./webpack.config.js
        entry: {
            // 入口配置项
            entry: './src/entery',
            entry2: './src/entry2'
        },
        output: {
            // 出口配置项
            // path -- 出口路径
            // filename -- 出口文件名
            path: path.resolve(__dirname, 'dist'),
            filename: '[name].js'
        },
    ```
    多入口对应了多出口，[name] 使用了变量，这里是指入口文件的文件名；在 webpack 中这里存在着各种各样的变量。先不细谈，以后会进行介绍；

4. 运行 webpack

    ```shell shell
        webpack
    ```

    输出

    ```shell shell
        Hash: 2099aec61566e04add44
        Version: webpack 3.10.0
        Time: 72ms
            Asset     Size  Chunks             Chunk Names
        entry2.js   2.5 kB       0  [emitted]  entry2
        entry.js  2.53 kB       1  [emitted]  entry
        [0] ./src/entery.js 55 bytes {1} [built]
        [1] ./src/entry2.js 18 bytes {0} [built]
    ```

5. 结束

    ```shell tree
        .
        ├── dist
        │   ├── bundle.js
        │   ├── entry.js
        │   ├── entry2.js
        │   └── index.html
        ├── package.json
        ├── src
        │   ├── entery.js
        │   └── entry2.js
        └── webpack.config.js
    ```

    其实到这里也仅仅是介绍 webpack 的输入和输出，并没有涉及到 webpack 的核心功能 -- 模块打包。但是这些介绍对于想了解 `webpack` 的是十分有帮助的；其实仅仅是简单的输入输出行为也是有很多参数支持的，这里暂不做细说；

#### webpack 对于 JS 模块化的实现

webpack 的主要功能就是处理前端模块化的，在 webpack 2.* 版本中就已经支持 ES6 的模块化语法, 可以对使用相应语法的文件进行打包操作；

1. 创建新文件 entry-son

    ```js entry-son.js src/entry-son.js
        console.log('这个文件是被打包进去的')
    ```
2. 修改 entry.js

    ```js entry.js src/entry.js
        import './entry-son';

        document.getElementById('title').innerHTML = 'webpack';
    ```

2. 运行 webpack
    
    ```shell shell
        webpack
    ```

    输出

    ```shell shell
        Hash: 7d2d43bbf5e9ef3815e8
        Version: webpack 3.10.0
        Time: 71ms
            Asset     Size  Chunks             Chunk Names
        entry.js  2.97 kB       0  [emitted]  entry
        entry2.js  2.49 kB       1  [emitted]  entry2
        [0] ./src/entery.js 78 bytes {0} [built]
        [1] ./src/entry-son.js 26 bytes {0} [built]
        [2] ./src/entry2.js 18 bytes {1} [built]
    ```

3. 结束

    ``` shell tree
        .
        └── learn01
            ├── dist
            │   ├── bundle.js
            │   ├── entry.js
            │   ├── entry2.js
            │   └── index.html
            ├── package.json
            ├── src
            │   ├── entery.js
            │   ├── entry-son.js
            │   └── entry2.js
            └── webpack.config.js
    ```

    打包输出的 entery.js 的代码

    ```js entery.js src/entery.js
        /* 0 */
        /***/ (function(module, __webpack_exports__, __webpack_require__) {

        "use strict";
        Object.defineProperty(__webpack_exports__, "__esModule", { value: true });
        /* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__entry_son__ = __webpack_require__(1);
        /* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__entry_son___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0__entry_son__);


        document.getElementById('title').innerHTML = 'webpack';

        /***/ }),
        /* 1 */
        /***/ (function(module, exports) {

        console.log('这个文件是被打包进去的')

        /***/ })
        /******/ ]);
    ```

    这里就能看出一些模块打包的意思了；

******

## TIP

{% blockquote %}
1. 建议在突然新的知识的时候，如果不妨碍对代码的理解，就先不要过多的关注；可以先记录下来然后以后再做了解；如果影响到了，那么查询的时候也不可深入，能达到对原文的理解的程度就可以了，避免分了心神；
{% endblockquote %}

******

## 结束

到这里基本上对 webpack 就有了初步的一个认识；但是距离将 webpack 应用到项目中其实还是远远不够的，希望继续努力吧；

*****

# 参考链接

链接 | 描述
---|---
[纯金 - Webpack 3.X版本 成神之路](https://www.chungold.com/course/32) | 说的十分高大上，但是也仅仅是一个入门 webpack 教程，适合对 webpack 一知半解的人加强对 webpack 的了解
  
  