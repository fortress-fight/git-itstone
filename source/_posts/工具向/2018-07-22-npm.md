---
title: npm
tags:
  - 工程化
  - npm
folder:
  - 工具向
abbrlink: a1345b2b
category:
  - 工程化
date: 2018-07-22 22:12:54
---

******

<!-- more -->

## NPM简介

`Node Package Manager` 简称 [NPM](npmjs.com) ，是 Node 默认的，由 JavaScript 编写的软件包管理工具

## NPM 的使用

[NPMDOC](https://docs.npmjs.com/)

查找 | 安装 | 卸载 | 更新 | package.json

### 查找

我们可以在 NPM 官网搜索需要使用的代码包，输入搜索词后，我们可以看到包裹的相关排名。NPM 分析器安装三个方面对包进行排序：`Optimal` (综合) | `Popularity` (最受欢迎) | Quality (质量) | Maintainance (维护) 在查找到我们需要的安装包后，我们进入了安装包的页面；

在安装包的页面上我们可以看到作者对包的相关介绍、该包所有依赖的项以及该包的版本说明；

### 安装

1. NPM 安装
    NPM 是用Node.js编写的，所以你需要安装Node.js才能使用npm。您可以通过Node.js网站安装npm，

2. 本地包安装
    如果安装的包是需要用于文件依赖的，那么我们需要使用 `npm install <package_name>` 命令，进行本地安装；
    安装完成后，将会产生 `node_module` 文件夹，用于存放安装的包文件。

    如果当前目录中没有 `package.json` 文件，npm 将会默认安装最新版本的包。如果存在 `package.json` 文件，将会根据文件中指定的规则进行安装 [版本规则计算器](https://semver.npmjs.com/)；

    简单的说文件版本：

    ```md
        补丁发布：1.0或1.0.x或~1.0.4 (~ 是指安装的时候安装 1.0.x 下最新的包版本)
        次要版本：1或1.x或^1.0.4 (^ 是指安装 1.x 下最新的包版本)
        主要版本：*或x (* 安装最新的版本)
    ```

3. 全局安装
    如果要将程序包用作命令行工具，请在全局安装它。这样，无论哪个目录是最新的，它都可以工作。使用命令 `npm install -g <package>`

### NPM 包卸载

    我们可以通过命令 `npm uninstall <package_name>` 的方式删除一个 npm 包，如果需要在 package.json 中移除这个包，我们需要使用 `npm uninstall --save` 如果移除的是 `devdependence` 里的包，需要使用 `npm uninstall --save-dev` 的方式进行卸载

### package.json

    管理本地安装的 npm 包的最佳方法是创建一个 package.json文件。

    一个package.json文件包含：
    - 列出项目所依赖的包。
    - 允许您使用语义版本控制规则指定项目可以使用的包的版本。
    - 使您的构建可重现，因此更容易与其他开发人员共享。

    创建一个 package.json
    - `npm init`
        - 如果需要直接使用默认设置可以使用 `npm init --yes`
        
    一个默认的 package.json 通常包含以下信息：

    ```json

        {
            "name": "my_package",
            "description": "",
            "version": "1.0.0",
            "main": "index.js",
            "scripts": {
                "test": "echo \"Error: no test specified\" && exit 1"
            },
            "repository": {
                "type": "git",
                "url": "https://github.com/ashleygwilliams/my_package.git"
            },
            "keywords": [],
            "author": "",
            "license": "ISC",
            "bugs": {
                "url": "https://github.com/ashleygwilliams/my_package/issues"
            },
            "homepage": "https://github.com/ashleygwilliams/my_package"
        }

    ```
    
    如果需要自定义问答方式，以及默认的字段可以通过 `.npm-init.js` 进行设置，由于这里仅仅是对 npm 的介绍，暂不涉及到这些方面；

    指定依赖项
    - "dependencies"：您的应用程序在生产中需要这些包。
    - "devDependencies"：这些包仅用于开发和测试。

    我们通过 `npm install <package_name>` 的方式进行安装：

    - "npm install <package_name> [--save-prod]" -- 添加到生产环境依赖（dependencies）列表中
    - "npm install <package_name> [--save-dev]" -- 添加到开发环境依赖（devdependencies) 列表中

### NPM 包更新

    我们可以通过命令 `npm outdated` 来查看已经安装的（过时的） npm 包的版本状态；通过 `npm update` 对版本进行升级

    `npm update [-g] [<pkg>...]` 此命令将**更新**列出到最新版本（由tag配置指定）的所有软件包。

    它还将安装缺少的包。与安装软件包的所有命令一样，该--dev标志也将devDependencies被处理。

    如果-g指定了该标志，则此命令将更新全局安装的软件包。如果需要更新一级的包，可以通过如下命令：`npm outdated -g --depth=0`

    如果未指定包名，则将更新指定位置（全局或本地）中的所有包。

### package vars

`package.json` 字段被添加到 `npm_package_` 前缀上。
因此，例如，如果您{"name":"foo", "version":"1.2.5"}在package.json文件中，那么您的包脚本将 npm_package_name环境变量设置为“foo”，并将 npm_package_version设置设置为“1.2.5”

配置参数放在带有 `npm_config_` 前缀的环境中 。例如，您可以 root 通过检查 `npm_config_root` 环境变量来查看有效配置。

例如：

```json
{ "name" : "foo"
, "config" : { "port" : "8080" }
, "scripts" : { "start" : "node server.js" } }
```

那么 我们可以通过 `process.env.npm_package_config_port` 的方式引用 config; 并且对于 config  用户可以使用 `npm config set foo:port 80` 对其进行修改

## NPM CLI

### `npm install`

说明：在本地node_modules文件夹中安装依赖项。在全局模式下（即，使用-g或--global附加到命令），它将当前包上下文（即，当前工作目录）安装为全局包。

`npm install <package_name>` 默认情况下将任何指定的包保存。此外，您可以通过一些额外的标志来控制保存的位置和方式：

- -P, --save-prod：package 将出现在您的dependencies。除非-D或-O存在，否则这是默认值。
- -D, --save-dev：package 将出现在您的devDependencies。
- -O, --save-optional：package 将出现在您的optionalDependencies。
- --no-save：防止保存到dependencies。
- E, --save-exact: 保存的依赖项将使用精确版本配置，而不是使用 npm 默认的 semver 范围运算符 （当你不希望安装的版本进行更新时使用）

### `npm run-script`

```cli
    npm run-script <command> [--silent] [-- <args>...]
    alias: npm run
```

这会从包的"scripts"对象运行任意命令。如果未 "command"提供，则会列出可用的脚本。 
run[-script]由test，start，restart和stop命令使用，但也可以直接调用。当打印出包中的脚本时，它们将分为生命周期（测试，启动，重启）和直接运行的脚本。
